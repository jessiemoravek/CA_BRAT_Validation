---
title: "BRAT_Comparison_Statistics_CA"
output: html_document
date: "2025-10-13"
---

#Written by Michelle Andruss
#Workshoped with Andrew Arlt and Jessie Moravek
#Last Updated: 10/11/2025


#Import Libraries
```{r include=FALSE}

library(tidyverse)
library(ggplot2)
library(yardstick)
library(dplyr)
library(Metrics)
library(caret)
library(ggpmisc)

```

#HUC 18090208######################################################################################
##Import Data 
```{r include=FALSE}
#Import Observed VS Predicted CSVs


#Original BRAT Version
OG <- read_csv("18090208_NoVegUpdate_Observed_Capacity.csv")

#By Reach Updated BRAT Version
REACH <- read_csv("18090208_ByReachUpdate_Observed_Capacity.csv")

#Universal updated BRAT version
UNI <- read_csv("18090208_UniversalUpdate_Observed_Capacity.csv")

sum(OG$DamKM>0)

```


## STEP 1: JUSTIFY CHANGES AND MODEL UPDATES ####################################################
### Multilinear Regression for Observed Beaver Capacity 
```{r}
#Significant Variables in the BRAT Attribute Table

#iGeo_Len - Reach Length
#iHyd_SPLow - low flow and slope
#iHyd_SP2 - 
#iGeo_Slope -
#iVeg100EX - Average Vegetation Code within 100 meters
#iVeg_30EX Average Vegetation Code within 30 meters
#iGeo_DA

#iGeo_ElMin -- NOT INCLUDED IN RIVERSCAPES BRAT VERSION
#iGeo_ElMax -- NOT INCLUDED IN RIVERSCAPES BRAT VERSION

#BASE CODE
#MLR_Version <- lm(Observed_Dam_Capacity_Variable ~ Important_Variable_1 + Important_Var_2)
#summary(MLR_Version)


#Multilinear Regression for Observed Beaver Capacity on all segments 
MLR_Observed <- lm(DamKM ~ iGeo_Len + iHyd_SPLow + iHyd_SP2 + iGeo_Slope + iVeg100EX + iVeg_30EX + iGeo_DA ,
  data = OG)

summary(MLR_Observed)

#Subset for only segments with observed capacity
Non_Zero_OG <- subset(OG, DamKM != 0)

#Multilinear Regression for Observed Beaver Capacity on segments with observed capacity
MLR_subsetted_Observed <- lm(DamKM ~ iGeo_Len + iHyd_SPLow + iHyd_SP2 + iGeo_Slope + iVeg100EX + iVeg_30EX + iGeo_DA ,
  data = Non_Zero_OG)

summary(MLR_subsetted_Observed)

```


## STEP 2: RUN STATISTICS FOR COMPARISON ########################################################
###Clean Up Data
```{r}

#subset out data based on output of multilinear regression
#subset_version <- subset(df, Variable (=, !=, >, <, =>, =<) value, etc)

#Subset data for segments with observed capacity and stream segments => 40
subset_OG <- subset(OG, DamKM != 0 & iGeo_Len >= 40)
subset_REACH <- subset(REACH, DamKM != 0 & iGeo_Len >= 40)
subset_UNI <- subset(UNI, DamKM != 0 & iGeo_Len >= 40)

#Subset data for stream segments => 40
geo_OG <- subset(OG, iGeo_Len >= 40)
geo_REACH <- subset(REACH, iGeo_Len >= 40)
geo_UNI <- subset(UNI, iGeo_Len >= 40)
```

### Multilinear Regression Adjusted R^2 Value ##
```{r}
#Create a function to run a multilinear regression for predicted values and important variables determined earlier
MLR_oCC_EX <- function(df, title) {
  
  MLR <- lm(oCC_EX ~ iGeo_Len + iHyd_SPLow + iHyd_SP2 + iGeo_Slope + iVeg100EX + iVeg_30EX + iGeo_DA ,
  data = df)
  
  print(title)
  summary(MLR)
}

#Call the function with your data 
#MLR_oCC_EX(df, title)

MLR_oCC_EX(geo_OG, "Original BRAT")
MLR_oCC_EX(geo_REACH, "By Reach Updated BRAT")
MLR_oCC_EX(geo_UNI, "Universal Updated BRAT")
```

### Aggregeated R^2 Value ##
```{r}
# Set up functions to  do the following: 

#1) Add BRAT Capacity Categories to the subset data based on oCC_EX values
categorize <- function(df) {
  df %>% 
  mutate(Category = case_when(oCC_EX >= 15 ~ "Pervasive",
                    oCC_EX >= 5 ~ "Frequent",
                    oCC_EX >= 1 ~ "Occasional",
                    oCC_EX > 0 ~ "Rare",
                    oCC_EX == 0 ~ "None"))

}


#2) Create a new data frame with values averaged and grouped by category
group <- function(df) {
  
  grouped_df <- df %>%
    group_by(Category) %>%
    summarize(
      mean_predicted = mean(oCC_EX, na.rm = TRUE),
      mean_observed  = mean(DamKM, na.rm = TRUE)
    )
  
  #Reorder categories for plotting
  grouped_df$Category <- factor(
    grouped_df$Category,
    levels = c("Pervasive", "Frequent", "Occasional", "Rare", "None")
  )

  return(grouped_df)
}

#3) Plot the averaged values and return an R^2 value
agg_r_plot <- function(grouped_df, title) {
  
  ggplot(grouped_df, aes(mean_predicted, mean_observed, col = Category)) +
    geom_point(size = 3) +
    stat_poly_line(mapping = aes(group = 1), se = FALSE, method = "lm", color = "black") +
    stat_poly_eq(mapping = aes(group = 1)) +  # ensures stats aren't split by color
    scale_color_manual(values = c(
      "Pervasive" = "blue",
      "Frequent" = "green",
      "Occasional" = "yellow",
      "Rare" = "orange",
      "None" = "red"
    )) +
    labs(
      title = title,
      x = "Predicted Maximum Capacity (dams/km)",
      y = "Observed Dam Density (dams/km)"
    ) +
    theme_classic()
}


#Call data to run through the categorize function
#df <- categorize(df)

geo_OG <- categorize(geo_OG)
geo_REACH <- categorize(geo_REACH)
geo_UNI <- categorize(geo_UNI)

subset_OG <- categorize(subset_OG)
subset_REACH <- categorize(subset_REACH)
subset_UNI <- categorize(subset_UNI)


#Call data to run through the group function
#grouped_df <- group(df)

grouped_OG <- group(geo_OG)
grouped_REACH <- group(geo_REACH)
grouped_UNI <- group(geo_UNI)


#Call data to run through the aggregate R^2 plot function
#agg_r_plot(grouped_df, "plot title")

agg_r_plot(grouped_OG, "Original")
agg_r_plot(grouped_REACH, "By Reach Updates")
agg_r_plot(grouped_UNI, "Universal Updates")

```

### Electivity Index
```{r}
# Set up function to calculate Electivity Index
EI <- function(df){
  colnames(df)
  
  #calculate total drainage network in m
  TotalDrainageNetwork <- sum(df$iGeo_Len)
  TotalDams <- sum(df$Join_Count)

  #group by category and calculate summary stats
  table_df <- df %>% group_by(Category) %>%
    summarize(StreamLength = sum(iGeo_Len)*.001,
             PercentDrainageNetwork = 100*(sum(iGeo_Len)/TotalDrainageNetwork),
              SurveyedDams = sum(Join_Count),
              BratEstimatedCapacity = sum(mCC_EX_CT),
              AvgSurveyedDamDensity = mean(DamKM),
              AvgPredictedCapacity = mean(oCC_EX), 
              PercentModeledCapacity = AvgSurveyedDamDensity/AvgPredictedCapacity*100,
              Electivity = (sum(Join_Count)/TotalDams)/(sum(iGeo_Len)/TotalDrainageNetwork)) %>%
    mutate(Category = factor(Category, levels = c("None","Rare","Occasional","Frequent","Pervasive"))) %>%
    arrange(Category)
  
#From Jordan: We calculate Electivity by adding up the number of dams along reaches within a given BRAT capacity category (e.g., 'frequent')  divided by the total number of dams then dividing that by the length of channel in that category divided by the total length of channel. 
#EIi=(ni/sum(n)) / (li/sum(l))

#that way, if a lot of dams occur on a category with a small fraction of the length, it is essentially 'overemphasized' vs if there are relatively few dams on a category with a large fraction of the length they're 'underemphasized'. Values of ~1 are neutral and anything >1 is preference. Since it's not normalized, it doesn't work to quantitatively compare watersheds to each other, just to assess relative preference within a watershed.

  table_df
  

}

#call data to run through Electivity Index Function
#EI(df)

EI(geo_OG)
EI(geo_REACH)
EI(geo_UNI)

```

### RMSE 
```{r}
#Create a function to calculate the Root Mean Square Error

RMSE <- function(df, title) {
  print(title)
  rmse_value <- sqrt(mean((df$oCC_EX - df$DamKM)^2, na.rm = TRUE))
  return(rmse_value)
}

#Call data to run through RMSE function 
#RMSE(df, title)

RMSE(geo_OG, "subset OG")
RMSE(geo_REACH, "subset REACH")
RMSE(geo_UNI, "subset UNI")

```

### Mean Absolute Error
```{r}
#Create a function to calculate Mean Absolute Error
MAE <- function(df, title) {
  print(title)
  mean(abs(df$DamKM - df$oCC_EX))
}


#Call data to run MAE function 
#MAE(df, title)
MAE(geo_OG, "subset OG")
MAE(geo_REACH, "subset REACH")
MAE(geo_UNI, "subset UNI")


```


### Confusion Matrix
####Clean Up Data
```{r}
# Create function to Add Observed Categories to data 
observed_cat <- function(df) {
  df %>% 
  mutate(Obs_Category = case_when(DamKM >= 15 ~ "Pervasive",
                    DamKM >= 5 ~ "Frequent",
                    DamKM >= 1 ~ "Occasional",
                    DamKM > 0 ~ "Rare",
                    DamKM == 0 ~ "None"))

}

#Call function to Add Observed Categories to data
#observed_cat(df)

geo_OG <- observed_cat(geo_OG)
geo_REACH <- observed_cat(geo_REACH)
geo_UNI <- observed_cat(geo_UNI)


subset_OG <- observed_cat(subset_OG)
subset_REACH <- observed_cat(subset_REACH)
subset_UNI <- observed_cat(subset_UNI)


```

#### Confusion Matrix Table and Plot
```{r}
# Create function to create a confusion matrix table and plot
CM <- function(df, title) {

  categories <- c("Pervasive", "Frequent", "Occasional", "Rare", "None")
  df <- df %>%
    mutate(
      Category = factor(Category, levels = categories),
      Obs_Category = factor(Obs_Category, levels = categories)
    )

  # Confusion matrix 
  cm <- confusionMatrix(df$Category, df$Obs_Category)
  print(cm)  # Accuracy, Kappa, per-class metrics

  # Extract overall metrics
  accuracy <- cm$overall['Accuracy']
  kappa <- cm$overall['Kappa']

  # Extract per-class metrics (precision, recall, F1)
  per_class_metrics <- cm$byClass[, c("Precision", "Recall", "F1")]
  print(accuracy)
  print(kappa)
  print(per_class_metrics)

  # Compute average F1
  avg_f1 <- mean(per_class_metrics[, "F1"], na.rm = TRUE)

  # Create confusion matrix table for ggplot
  cm_table <- df %>%
    count(Obs_Category, Category) %>%
    complete(Obs_Category = categories, Category = categories, fill = list(n = 0)) %>%
    group_by(Obs_Category) %>%                   # Row-normalize for percentages
    mutate(perc = n / sum(n)) %>%
    ungroup()

  # Merge F1 scores into cm_table for diagonal labels
  f1_df <- data.frame(
    Obs_Category = categories,
    Category = categories,
    F1 = per_class_metrics[, "F1"]
  )

  cm_table <- cm_table %>%
    left_join(f1_df, by = c("Obs_Category", "Category"))

  # Plot
  ggplot(cm_table, aes(x = Category, y = Obs_Category, fill = perc)) +
    geom_tile(color = "grey", linewidth = 0.3) +
    
   # Outline center boxes
    geom_tile(
      data = subset(cm_table, Obs_Category == Category),
      color = "#032f3c", linewidth = 1, fill = NA
    ) +
    
    #Text 
    geom_text(aes(
      label = ifelse(
        Obs_Category == Category,
        sprintf("%.1f%%\nF1: %.2f", perc * 100, F1),
        sprintf("%.1f%%", perc * 100)
      )
    ),
    color = "black", size = 4.5, na.rm = TRUE
    ) +
    
    #Fill
    scale_fill_gradientn(
      colors = c("#f7fbff", "#87c4c6", "#046169"),
      name = "Percent"
    ) +
    
    
    labs(
      title = title,
      subtitle = sprintf("MACRO F1: %.2f", avg_f1),
      x = "Predicted Capacity Category",
      y = "Observed Capacity Category"
    ) +
    
    scale_x_discrete(limits = rev(categories)) +
    scale_y_discrete(limits = rev(categories)) +
    
    theme_minimal(base_size = 14) +
    theme(
      plot.title = element_text(size = 18, face = "bold", hjust = 0.5),
      plot.subtitle = element_text(size = 14, face = "bold", hjust = 0.5),
      axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1, size = 12),
      axis.text.y = element_text(size = 12),
      axis.title = element_text(size = 14),
      panel.grid = element_blank(),
      legend.position = "right",
      legend.title = element_text(size = 12, face = "bold"),
      legend.text = element_text(size = 11)
    )
}

# Call data to run CM function
#CM(df, "title")

CM(geo_OG, "Original")
CM(geo_REACH, "By Reach Updates")
CM(geo_UNI, "Universal Updates")


CM(subset_OG, "Original (Observations Only)")
CM(subset_REACH, "By Reach Updates (Observations Only)")
CM(subset_UNI, "Universal Updates (Observations Only)")


```



#HUC 18090101######################################################################################
##Import Data 
```{r}
#Import Observed VS Predicted CSVs

#Original BRAT Version
OG_18090101 <- read_csv("18090101_NoVegUpdate_Observed_Capacity.csv")

#By REACH_18090101 Updated BRAT Version
REACH_18090101 <- read_csv("18090101_ByReachUpdate_Observed_Capacity.csv")

#Universal updated BRAT version
UNI_18090101 <- read_csv("18090101_UniversalUpdate_Observed_Capacity.csv")

sum(OG_18090101$DamKM>0)
```


## STEP 1: JUSTIFY CHANGES AND MODEL UPDATES ####################################################
### Multilinear Regression for Observed Beaver Capacity 
```{r}
#Significant Variables in the BRAT Attribute Table

#Multilinear Regression for Observed Beaver Capacity on all segments 
MLR_Observed <- lm(DamKM ~ iGeo_Len + iHyd_SPLow + iHyd_SP2 + iGeo_Slope + iVeg100EX + iVeg_30EX + iGeo_DA ,
  data = OG_18090101)

summary(MLR_Observed)

#Subset for only segments with observed capacity
Non_Zero_OG_18090101 <- subset(OG_18090101, DamKM != 0)

#Multilinear Regression for Observed Beaver Capacity on segments with observed capacity
MLR_subsetted_Observed <- lm(DamKM ~ iGeo_Len + iHyd_SPLow + iHyd_SP2 + iGeo_Slope + iVeg100EX + iVeg_30EX + iGeo_DA ,
  data = Non_Zero_OG_18090101)

summary(MLR_subsetted_Observed)

```


## STEP 2: RUN STATISTICS FOR COMPARISON ########################################################
###Clean Up Data
```{r}
#Subset data for segments with observed capacity and stream segments => 40
subset_OG_18090101 <- subset(OG_18090101, DamKM != 0 & iGeo_Len >= 40)
subset_REACH_18090101 <- subset(REACH_18090101, DamKM != 0 & iGeo_Len >= 40)
subset_UNI_18090101 <- subset(UNI_18090101, DamKM != 0 & iGeo_Len >= 40)

#Subset data for stream segments => 40
geo_OG_18090101 <- subset(OG_18090101, iGeo_Len >= 40)
geo_REACH_18090101 <- subset(REACH_18090101, iGeo_Len >= 40)
geo_UNI_18090101 <- subset(UNI_18090101, iGeo_Len >= 40)
```

### Multilinear Regression Adjusted R^2 Value ##
```{r}
#Call the function with your data 
#MLR_oCC_EX(df, title)

MLR_oCC_EX(geo_OG_18090101, "Original BRAT")
MLR_oCC_EX(geo_REACH_18090101, "By Reach Updated BRAT")
MLR_oCC_EX(geo_UNI_18090101, "Universal Updated BRAT")
```

### Aggregeated R^2 Value ##
```{r}
#Call data to run through the categorize function
#df <- categorize(df)

geo_OG_18090101 <- categorize(geo_OG_18090101)
geo_REACH_18090101 <- categorize(geo_REACH_18090101)
geo_UNI_18090101 <- categorize(geo_UNI_18090101)

subset_OG_18090101 <- categorize(subset_OG_18090101)
subset_REACH_18090101 <- categorize(subset_REACH_18090101)
subset_UNI_18090101 <- categorize(subset_UNI_18090101)


#Call data to run through the group function
#grouped_df <- group(df)

grouped_OG_18090101 <- group(geo_OG_18090101)
grouped_REACH_18090101 <- group(geo_REACH_18090101)
grouped_UNI_18090101 <- group(geo_UNI_18090101)


#Call data to run through the aggregate R^2 plot function
#agg_r_plot(grouped_df, "plot title")

agg_r_plot(grouped_OG_18090101, "Original")
agg_r_plot(grouped_REACH_18090101, "By Reach Updates")
agg_r_plot(grouped_UNI_18090101, "Universal Updates")

```

### Electivity Index
```{r}
#call data to run through Electivity Index Function
#EI(df)

EI(geo_OG_18090101)
EI(geo_REACH_18090101)
EI(geo_UNI_18090101)

```

### RMSE 
```{r}
#Call data to run through RMSE function 
#RMSE(df, title)

RMSE(geo_OG_18090101, "subset OG_18090101")
RMSE(geo_REACH_18090101, "subset REACH_18090101")
RMSE(geo_UNI_18090101, "subset UNI_18090101")

```

### Mean Absolute Error
```{r}
#Call data to run MAE function 
#MAE(df, title)
MAE(geo_OG_18090101, "subset OG_18090101")
MAE(geo_REACH_18090101, "subset REACH_18090101")
MAE(geo_UNI_18090101, "subset UNI_18090101")


```


### Confusion Matrix
####Clean Up Data
```{r}
#Call function to Add Observed Categories to data
#observed_cat(df)

geo_OG_18090101 <- observed_cat(geo_OG_18090101)
geo_REACH_18090101 <- observed_cat(geo_REACH_18090101)
geo_UNI_18090101 <- observed_cat(geo_UNI_18090101)


subset_OG_18090101 <- observed_cat(subset_OG_18090101)
subset_REACH_18090101 <- observed_cat(subset_REACH_18090101)
subset_UNI_18090101 <- observed_cat(subset_UNI_18090101)


```

#### Confusion Matrix Table and Plot
```{r}
# Call data to run CM function
#CM(df, "title")

CM(geo_OG_18090101, "Original")
CM(geo_REACH_18090101, "By Reach Updates")
CM(geo_UNI_18090101, "Universal Updates")


CM(subset_OG_18090101, "Original (Observations Only)")
CM(subset_REACH_18090101, "By Reach Updates (Observations Only)")
CM(subset_UNI_18090101, "Universal Updates (Observations Only)")


```


#HUC 18070302######################################################################################
##Import Data 
```{r}
#Import Observed VS Predicted CSVs

#Original BRAT Version
OG_18070302 <- read_csv("18070302_NoVegUpdate_Observed_Capacity.csv")

#By REACH_18070302 Updated BRAT Version
REACH_18070302 <- read_csv("18070302_ByReachUpdate_Observed_Capacity.csv")

#Universal updated BRAT version
UNI_18070302 <- read_csv("18070302_UniversalUpdate_Observed_Capacity.csv")

sum(OG_18070302$DamKM>0)

```


## STEP 1: JUSTIFY CHANGES AND MODEL UPDATES ####################################################
### Multilinear Regression for Observed Beaver Capacity 
```{r}
#Significant Variables in the BRAT Attribute Table

#Multilinear Regression for Observed Beaver Capacity on all segments 
MLR_Observed <- lm(DamKM ~ iGeo_Len + iHyd_SPLow + iHyd_SP2 + iGeo_Slope + iVeg100EX + iVeg_30EX + iGeo_DA ,
  data = OG_18070302)

summary(MLR_Observed)

#Subset for only segments with observed capacity
Non_Zero_OG_18070302 <- subset(OG_18070302, DamKM != 0)

#Multilinear Regression for Observed Beaver Capacity on segments with observed capacity
MLR_subsetted_Observed <- lm(DamKM ~ iGeo_Len + iHyd_SPLow + iHyd_SP2 + iGeo_Slope + iVeg100EX + iVeg_30EX + iGeo_DA ,
  data = Non_Zero_OG_18070302)

summary(MLR_subsetted_Observed)

```


## STEP 2: RUN STATISTICS FOR COMPARISON ########################################################
###Clean Up Data
```{r}
#Subset data for segments with observed capacity and stream segments => 40
subset_OG_18070302 <- subset(OG_18070302, DamKM != 0 & iGeo_Len >= 40)
subset_REACH_18070302 <- subset(REACH_18070302, DamKM != 0 & iGeo_Len >= 40)
subset_UNI_18070302 <- subset(UNI_18070302, DamKM != 0 & iGeo_Len >= 40)

#Subset data for stream segments => 40
geo_OG_18070302 <- subset(OG_18070302, iGeo_Len >= 40)
geo_REACH_18070302 <- subset(REACH_18070302, iGeo_Len >= 40)
geo_UNI_18070302 <- subset(UNI_18070302, iGeo_Len >= 40)
```

### Multilinear Regression Adjusted R^2 Value ##
```{r}
#Call the function with your data 
#MLR_oCC_EX(df, title)

MLR_oCC_EX(geo_OG_18070302, "Original BRAT")
MLR_oCC_EX(geo_REACH_18070302, "By Reach Updated BRAT")
MLR_oCC_EX(geo_UNI_18070302, "Universal Updated BRAT")
```

### Aggregeated R^2 Value ##
```{r}
#Call data to run through the categorize function
#df <- categorize(df)

geo_OG_18070302 <- categorize(geo_OG_18070302)
geo_REACH_18070302 <- categorize(geo_REACH_18070302)
geo_UNI_18070302 <- categorize(geo_UNI_18070302)

subset_OG_18070302 <- categorize(subset_OG_18070302)
subset_REACH_18070302 <- categorize(subset_REACH_18070302)
subset_UNI_18070302 <- categorize(subset_UNI_18070302)


#Call data to run through the group function
#grouped_df <- group(df)

grouped_OG_18070302 <- group(geo_OG_18070302)
grouped_REACH_18070302 <- group(geo_REACH_18070302)
grouped_UNI_18070302 <- group(geo_UNI_18070302)


#Call data to run through the aggregate R^2 plot function
#agg_r_plot(grouped_df, "plot title")

agg_r_plot(grouped_OG_18070302, "Original")
agg_r_plot(grouped_REACH_18070302, "By Reach Updates")
agg_r_plot(grouped_UNI_18070302, "Universal Updates")

```

### Electivity Index
```{r}
#call data to run through Electivity Index Function
#EI(df)

EI(geo_OG_18070302)
EI(geo_REACH_18070302)
EI(geo_UNI_18070302)

```

### RMSE 
```{r}
#Call data to run through RMSE function 
#RMSE(df, title)

RMSE(geo_OG_18070302, "subset OG_18070302")
RMSE(geo_REACH_18070302, "subset REACH_18070302")
RMSE(geo_UNI_18070302, "subset UNI_18070302")

```

### Mean Absolute Error
```{r}
#Call data to run MAE function 
#MAE(df, title)
MAE(geo_OG_18070302, "subset OG_18070302")
MAE(geo_REACH_18070302, "subset REACH_18070302")
MAE(geo_UNI_18070302, "subset UNI_18070302")


```


### Confusion Matrix
####Clean Up Data
```{r}
#Call function to Add Observed Categories to data
#observed_cat(df)

geo_OG_18070302 <- observed_cat(geo_OG_18070302)
geo_REACH_18070302 <- observed_cat(geo_REACH_18070302)
geo_UNI_18070302 <- observed_cat(geo_UNI_18070302)


subset_OG_18070302 <- observed_cat(subset_OG_18070302)
subset_REACH_18070302 <- observed_cat(subset_REACH_18070302)
subset_UNI_18070302 <- observed_cat(subset_UNI_18070302)


```

#### Confusion Matrix Table and Plot
```{r}
# Call data to run CM function
#CM(df, "title")

CM(geo_OG_18070302, "Original")
CM(geo_REACH_18070302, "By Reach Updates")
CM(geo_UNI_18070302, "Universal Updates")


CM(subset_OG_18070302, "Original (Observations Only)")
CM(subset_REACH_18070302, "By Reach Updates (Observations Only)")
CM(subset_UNI_18070302, "Universal Updates (Observations Only)")


```





#HUC 18060005######################################################################################
##Import Data 
```{r}
#Import Observed VS Predicted CSVs

#Original BRAT Version
OG_18060005 <- read_csv("18060005_NoVegUpdate_Observed_Capacity.csv")

#By REACH_18060005 Updated BRAT Version
REACH_18060005 <- read_csv("18060005_ByReachUpdate_Observed_Capacity.csv")

#Universal updated BRAT version
UNI_18060005 <- read_csv("18060005_UniversalUpdate_Observed_Capacity.csv")

sum(OG_18060005$DamKM>0)

```


## STEP 1: JUSTIFY CHANGES AND MODEL UPDATES ####################################################
### Multilinear Regression for Observed Beaver Capacity 
```{r}
#Significant Variables in the BRAT Attribute Table

#Multilinear Regression for Observed Beaver Capacity on all segments 
MLR_Observed <- lm(DamKM ~ iGeo_Len + iHyd_SPLow + iHyd_SP2 + iGeo_Slope + iVeg100EX + iVeg_30EX + iGeo_DA ,
  data = OG_18060005)

summary(MLR_Observed)

#Subset for only segments with observed capacity
Non_Zero_OG_18060005 <- subset(OG_18060005, DamKM != 0)

#Multilinear Regression for Observed Beaver Capacity on segments with observed capacity
MLR_subsetted_Observed <- lm(DamKM ~ iGeo_Len + iHyd_SPLow + iHyd_SP2 + iGeo_Slope + iVeg100EX + iVeg_30EX + iGeo_DA ,
  data = Non_Zero_OG_18060005)

summary(MLR_subsetted_Observed)

```


## STEP 2: RUN STATISTICS FOR COMPARISON ########################################################
###Clean Up Data
```{r}
#Subset data for segments with observed capacity and stream segments => 40
subset_OG_18060005 <- subset(OG_18060005, DamKM != 0 & iGeo_Len >= 40)
subset_REACH_18060005 <- subset(REACH_18060005, DamKM != 0 & iGeo_Len >= 40)
subset_UNI_18060005 <- subset(UNI_18060005, DamKM != 0 & iGeo_Len >= 40)

#Subset data for stream segments => 40
geo_OG_18060005 <- subset(OG_18060005, iGeo_Len >= 40)
geo_REACH_18060005 <- subset(REACH_18060005, iGeo_Len >= 40)
geo_UNI_18060005 <- subset(UNI_18060005, iGeo_Len >= 40)
```

### Multilinear Regression Adjusted R^2 Value ##
```{r}
#Call the function with your data 
#MLR_oCC_EX(df, title)

MLR_oCC_EX(geo_OG_18060005, "Original BRAT")
MLR_oCC_EX(geo_REACH_18060005, "By Reach Updated BRAT")
MLR_oCC_EX(geo_UNI_18060005, "Universal Updated BRAT")
```

### Aggregeated R^2 Value ##
```{r}
#Call data to run through the categorize function
#df <- categorize(df)

geo_OG_18060005 <- categorize(geo_OG_18060005)
geo_REACH_18060005 <- categorize(geo_REACH_18060005)
geo_UNI_18060005 <- categorize(geo_UNI_18060005)

subset_OG_18060005 <- categorize(subset_OG_18060005)
subset_REACH_18060005 <- categorize(subset_REACH_18060005)
subset_UNI_18060005 <- categorize(subset_UNI_18060005)


#Call data to run through the group function
#grouped_df <- group(df)

grouped_OG_18060005 <- group(geo_OG_18060005)
grouped_REACH_18060005 <- group(geo_REACH_18060005)
grouped_UNI_18060005 <- group(geo_UNI_18060005)


#Call data to run through the aggregate R^2 plot function
#agg_r_plot(grouped_df, "plot title")

agg_r_plot(grouped_OG_18060005, "Original")
agg_r_plot(grouped_REACH_18060005, "By Reach Updates")
agg_r_plot(grouped_UNI_18060005, "Universal Updates")

```

### Electivity Index
```{r}
#call data to run through Electivity Index Function
#EI(df)

EI(geo_OG_18060005)
EI(geo_REACH_18060005)
EI(geo_UNI_18060005)

```

### RMSE 
```{r}
#Call data to run through RMSE function 
#RMSE(df, title)

RMSE(geo_OG_18060005, "subset OG_18060005")
RMSE(geo_REACH_18060005, "subset REACH_18060005")
RMSE(geo_UNI_18060005, "subset UNI_18060005")

```

### Mean Absolute Error
```{r}
#Call data to run MAE function 
#MAE(df, title)
MAE(geo_OG_18060005, "subset OG_18060005")
MAE(geo_REACH_18060005, "subset REACH_18060005")
MAE(geo_UNI_18060005, "subset UNI_18060005")


```


### Confusion Matrix
####Clean Up Data
```{r}
#Call function to Add Observed Categories to data
#observed_cat(df)

geo_OG_18060005 <- observed_cat(geo_OG_18060005)
geo_REACH_18060005 <- observed_cat(geo_REACH_18060005)
geo_UNI_18060005 <- observed_cat(geo_UNI_18060005)


subset_OG_18060005 <- observed_cat(subset_OG_18060005)
subset_REACH_18060005 <- observed_cat(subset_REACH_18060005)
subset_UNI_18060005 <- observed_cat(subset_UNI_18060005)


```

#### Confusion Matrix Table and Plot
```{r}
# Call data to run CM function
#CM(df, "title")

CM(geo_OG_18060005, "Original")
CM(geo_REACH_18060005, "By Reach Updates")
CM(geo_UNI_18060005, "Universal Updates")


CM(subset_OG_18060005, "Original (Observations Only)")
CM(subset_REACH_18060005, "By Reach Updates (Observations Only)")
CM(subset_UNI_18060005, "Universal Updates (Observations Only)")


```



#HUC 18050002######################################################################################
##Import Data 
```{r}
#Import Observed VS Predicted CSVs

#Original BRAT Version
OG_18050002 <- read_csv("18050002_NoVegUpdate_Observed_Capacity.csv")

#By REACH_18050002 Updated BRAT Version
REACH_18050002 <- read_csv("18050002_ByReachUpdate_Observed_Capacity.csv")

#Universal updated BRAT version
UNI_18050002 <- read_csv("18050002_UniversalUpdate_Observed_Capacity.csv")

sum(OG_18050002$DamKM>0)
```


## STEP 1: JUSTIFY CHANGES AND MODEL UPDATES ####################################################
### Multilinear Regression for Observed Beaver Capacity 
```{r}
#Significant Variables in the BRAT Attribute Table

#Multilinear Regression for Observed Beaver Capacity on all segments 
MLR_Observed <- lm(DamKM ~ iGeo_Len + iHyd_SPLow + iHyd_SP2 + iGeo_Slope + iVeg100EX + iVeg_30EX + iGeo_DA ,
  data = OG_18050002)

summary(MLR_Observed)

#Subset for only segments with observed capacity
Non_Zero_OG_18050002 <- subset(OG_18050002, DamKM != 0)

#Multilinear Regression for Observed Beaver Capacity on segments with observed capacity
MLR_subsetted_Observed <- lm(DamKM ~ iGeo_Len + iHyd_SPLow + iHyd_SP2 + iGeo_Slope + iVeg100EX + iVeg_30EX + iGeo_DA ,
  data = Non_Zero_OG_18050002)

summary(MLR_subsetted_Observed)

```


## STEP 2: RUN STATISTICS FOR COMPARISON ########################################################
###Clean Up Data
```{r}
#Subset data for segments with observed capacity and stream segments => 40
subset_OG_18050002 <- subset(OG_18050002, DamKM != 0 & iGeo_Len >= 40)
subset_REACH_18050002 <- subset(REACH_18050002, DamKM != 0 & iGeo_Len >= 40)
subset_UNI_18050002 <- subset(UNI_18050002, DamKM != 0 & iGeo_Len >= 40)

#Subset data for stream segments => 40
geo_OG_18050002 <- subset(OG_18050002, iGeo_Len >= 40)
geo_REACH_18050002 <- subset(REACH_18050002, iGeo_Len >= 40)
geo_UNI_18050002 <- subset(UNI_18050002, iGeo_Len >= 40)
```

### Multilinear Regression Adjusted R^2 Value ##
```{r}
#Call the function with your data 
#MLR_oCC_EX(df, title)

MLR_oCC_EX(geo_OG_18050002, "Original BRAT")
MLR_oCC_EX(geo_REACH_18050002, "By Reach Updated BRAT")
MLR_oCC_EX(geo_UNI_18050002, "Universal Updated BRAT")
```

### Aggregeated R^2 Value ##
```{r}
#Call data to run through the categorize function
#df <- categorize(df)

geo_OG_18050002 <- categorize(geo_OG_18050002)
geo_REACH_18050002 <- categorize(geo_REACH_18050002)
geo_UNI_18050002 <- categorize(geo_UNI_18050002)

subset_OG_18050002 <- categorize(subset_OG_18050002)
subset_REACH_18050002 <- categorize(subset_REACH_18050002)
subset_UNI_18050002 <- categorize(subset_UNI_18050002)


#Call data to run through the group function
#grouped_df <- group(df)

grouped_OG_18050002 <- group(geo_OG_18050002)
grouped_REACH_18050002 <- group(geo_REACH_18050002)
grouped_UNI_18050002 <- group(geo_UNI_18050002)


#Call data to run through the aggregate R^2 plot function
#agg_r_plot(grouped_df, "plot title")

agg_r_plot(grouped_OG_18050002, "Original")
agg_r_plot(grouped_REACH_18050002, "By Reach Updates")
agg_r_plot(grouped_UNI_18050002, "Universal Updates")

```

### Electivity Index
```{r}
#call data to run through Electivity Index Function
#EI(df)

EI(geo_OG_18050002)
EI(geo_REACH_18050002)
EI(geo_UNI_18050002)

```

### RMSE 
```{r}
#Call data to run through RMSE function 
#RMSE(df, title)

RMSE(geo_OG_18050002, "subset OG_18050002")
RMSE(geo_REACH_18050002, "subset REACH_18050002")
RMSE(geo_UNI_18050002, "subset UNI_18050002")

```

### Mean Absolute Error
```{r}
#Call data to run MAE function 
#MAE(df, title)
MAE(geo_OG_18050002, "subset OG_18050002")
MAE(geo_REACH_18050002, "subset REACH_18050002")
MAE(geo_UNI_18050002, "subset UNI_18050002")


```


### Confusion Matrix
####Clean Up Data
```{r}
#Call function to Add Observed Categories to data
#observed_cat(df)

geo_OG_18050002 <- observed_cat(geo_OG_18050002)
geo_REACH_18050002 <- observed_cat(geo_REACH_18050002)
geo_UNI_18050002 <- observed_cat(geo_UNI_18050002)


subset_OG_18050002 <- observed_cat(subset_OG_18050002)
subset_REACH_18050002 <- observed_cat(subset_REACH_18050002)
subset_UNI_18050002 <- observed_cat(subset_UNI_18050002)


```

#### Confusion Matrix Table and Plot
```{r}
# Call data to run CM function
#CM(df, "title")

CM(geo_OG_18050002, "Original")
CM(geo_REACH_18050002, "By Reach Updates")
CM(geo_UNI_18050002, "Universal Updates")


CM(subset_OG_18050002, "Original (Observations Only)")
CM(subset_REACH_18050002, "By Reach Updates (Observations Only)")
CM(subset_UNI_18050002, "Universal Updates (Observations Only)")


```


#HUC 18030002######################################################################################
##Import Data 
```{r}
#Import Observed VS Predicted CSVs

#Original BRAT Version
OG_18030002 <- read_csv("18030002_NoVegUpdate_Observed_Capacity.csv")

#By REACH_18030002 Updated BRAT Version
REACH_18030002 <- read_csv("18030002_ByReachUpdate_Observed_Capacity.csv")

#Universal updated BRAT version
UNI_18030002 <- read_csv("18030002_UniversalUpdate_Observed_Capacity.csv")

sum(OG_18030002$DamKM>0)

```


## STEP 1: JUSTIFY CHANGES AND MODEL UPDATES ####################################################
### Multilinear Regression for Observed Beaver Capacity 
```{r}
#Significant Variables in the BRAT Attribute Table

#Multilinear Regression for Observed Beaver Capacity on all segments 
MLR_Observed <- lm(DamKM ~ iGeo_Len + iHyd_SPLow + iHyd_SP2 + iGeo_Slope + iVeg100EX + iVeg_30EX + iGeo_DA ,
  data = OG_18030002)

summary(MLR_Observed)

#Subset for only segments with observed capacity
Non_Zero_OG_18030002 <- subset(OG_18030002, DamKM != 0)

#Multilinear Regression for Observed Beaver Capacity on segments with observed capacity
MLR_subsetted_Observed <- lm(DamKM ~ iGeo_Len + iHyd_SPLow + iHyd_SP2 + iGeo_Slope + iVeg100EX + iVeg_30EX + iGeo_DA ,
  data = Non_Zero_OG_18030002)

summary(MLR_subsetted_Observed)

```


## STEP 2: RUN STATISTICS FOR COMPARISON ########################################################
###Clean Up Data
```{r}
#Subset data for segments with observed capacity and stream segments => 40
subset_OG_18030002 <- subset(OG_18030002, DamKM != 0 & iGeo_Len >= 40)
subset_REACH_18030002 <- subset(REACH_18030002, DamKM != 0 & iGeo_Len >= 40)
subset_UNI_18030002 <- subset(UNI_18030002, DamKM != 0 & iGeo_Len >= 40)

#Subset data for stream segments => 40
geo_OG_18030002 <- subset(OG_18030002, iGeo_Len >= 40)
geo_REACH_18030002 <- subset(REACH_18030002, iGeo_Len >= 40)
geo_UNI_18030002 <- subset(UNI_18030002, iGeo_Len >= 40)
```

### Multilinear Regression Adjusted R^2 Value ##
```{r}
#Call the function with your data 
#MLR_oCC_EX(df, title)

MLR_oCC_EX(geo_OG_18030002, "Original BRAT")
MLR_oCC_EX(geo_REACH_18030002, "By Reach Updated BRAT")
MLR_oCC_EX(geo_UNI_18030002, "Universal Updated BRAT")
```

### Aggregeated R^2 Value ##
```{r}
#Call data to run through the categorize function
#df <- categorize(df)

geo_OG_18030002 <- categorize(geo_OG_18030002)
geo_REACH_18030002 <- categorize(geo_REACH_18030002)
geo_UNI_18030002 <- categorize(geo_UNI_18030002)

subset_OG_18030002 <- categorize(subset_OG_18030002)
subset_REACH_18030002 <- categorize(subset_REACH_18030002)
subset_UNI_18030002 <- categorize(subset_UNI_18030002)


#Call data to run through the group function
#grouped_df <- group(df)

grouped_OG_18030002 <- group(geo_OG_18030002)
grouped_REACH_18030002 <- group(geo_REACH_18030002)
grouped_UNI_18030002 <- group(geo_UNI_18030002)


#Call data to run through the aggregate R^2 plot function
#agg_r_plot(grouped_df, "plot title")

agg_r_plot(grouped_OG_18030002, "Original")
agg_r_plot(grouped_REACH_18030002, "By Reach Updates")
agg_r_plot(grouped_UNI_18030002, "Universal Updates")

```

### Electivity Index
```{r}
#call data to run through Electivity Index Function
#EI(df)

EI(geo_OG_18030002)
EI(geo_REACH_18030002)
EI(geo_UNI_18030002)

```

### RMSE 
```{r}
#Call data to run through RMSE function 
#RMSE(df, title)

RMSE(geo_OG_18030002, "subset OG_18030002")
RMSE(geo_REACH_18030002, "subset REACH_18030002")
RMSE(geo_UNI_18030002, "subset UNI_18030002")

```

### Mean Absolute Error
```{r}
#Call data to run MAE function 
#MAE(df, title)
MAE(geo_OG_18030002, "subset OG_18030002")
MAE(geo_REACH_18030002, "subset REACH_18030002")
MAE(geo_UNI_18030002, "subset UNI_18030002")


```


### Confusion Matrix
####Clean Up Data
```{r}
#Call function to Add Observed Categories to data
#observed_cat(df)

geo_OG_18030002 <- observed_cat(geo_OG_18030002)
geo_REACH_18030002 <- observed_cat(geo_REACH_18030002)
geo_UNI_18030002 <- observed_cat(geo_UNI_18030002)


subset_OG_18030002 <- observed_cat(subset_OG_18030002)
subset_REACH_18030002 <- observed_cat(subset_REACH_18030002)
subset_UNI_18030002 <- observed_cat(subset_UNI_18030002)


```

#### Confusion Matrix Table and Plot
```{r}
# Call data to run CM function
#CM(df, "title")

CM(geo_OG_18030002, "Original")
CM(geo_REACH_18030002, "By Reach Updates")
CM(geo_UNI_18030002, "Universal Updates")


CM(subset_OG_18030002, "Original (Observations Only)")
CM(subset_REACH_18030002, "By Reach Updates (Observations Only)")
CM(subset_UNI_18030002, "Universal Updates (Observations Only)")


```




#HUC 18020163######################################################################################
##Import Data 
```{r}
#Import Observed VS Predicted CSVs

#Original BRAT Version
OG_18020163 <- read_csv("18020163_NoVegUpdate_Observed_Capacity.csv")

#By REACH_18020163 Updated BRAT Version
REACH_18020163 <- read_csv("18020163_ByReachUpdate_Observed_Capacity.csv")

#Universal updated BRAT version
UNI_18020163 <- read_csv("18020163_UniversalUpdate_Observed_Capacity.csv")

sum(OG_18020163$DamKM>0)

```


## STEP 1: JUSTIFY CHANGES AND MODEL UPDATES ####################################################
### Multilinear Regression for Observed Beaver Capacity 
```{r}
#Significant Variables in the BRAT Attribute Table

#Multilinear Regression for Observed Beaver Capacity on all segments 
MLR_Observed <- lm(DamKM ~ iGeo_Len + iHyd_SPLow + iHyd_SP2 + iGeo_Slope + iVeg100EX + iVeg_30EX + iGeo_DA ,
  data = OG_18020163)

summary(MLR_Observed)

#Subset for only segments with observed capacity
Non_Zero_OG_18020163 <- subset(OG_18020163, DamKM != 0)

#Multilinear Regression for Observed Beaver Capacity on segments with observed capacity
MLR_subsetted_Observed <- lm(DamKM ~ iGeo_Len + iHyd_SPLow + iHyd_SP2 + iGeo_Slope + iVeg100EX + iVeg_30EX + iGeo_DA ,
  data = Non_Zero_OG_18020163)

summary(MLR_subsetted_Observed)

```


## STEP 2: RUN STATISTICS FOR COMPARISON ########################################################
###Clean Up Data
```{r}
#Subset data for segments with observed capacity and stream segments => 40
subset_OG_18020163 <- subset(OG_18020163, DamKM != 0 & iGeo_Len >= 40)
subset_REACH_18020163 <- subset(REACH_18020163, DamKM != 0 & iGeo_Len >= 40)
subset_UNI_18020163 <- subset(UNI_18020163, DamKM != 0 & iGeo_Len >= 40)

#Subset data for stream segments => 40
geo_OG_18020163 <- subset(OG_18020163, iGeo_Len >= 40)
geo_REACH_18020163 <- subset(REACH_18020163, iGeo_Len >= 40)
geo_UNI_18020163 <- subset(UNI_18020163, iGeo_Len >= 40)
```

### Multilinear Regression Adjusted R^2 Value ##
```{r}
#Call the function with your data 
#MLR_oCC_EX(df, title)

MLR_oCC_EX(geo_OG_18020163, "Original BRAT")
MLR_oCC_EX(geo_REACH_18020163, "By Reach Updated BRAT")
MLR_oCC_EX(geo_UNI_18020163, "Universal Updated BRAT")
```

### Aggregeated R^2 Value ##
```{r}
#Call data to run through the categorize function
#df <- categorize(df)

geo_OG_18020163 <- categorize(geo_OG_18020163)
geo_REACH_18020163 <- categorize(geo_REACH_18020163)
geo_UNI_18020163 <- categorize(geo_UNI_18020163)

subset_OG_18020163 <- categorize(subset_OG_18020163)
subset_REACH_18020163 <- categorize(subset_REACH_18020163)
subset_UNI_18020163 <- categorize(subset_UNI_18020163)


#Call data to run through the group function
#grouped_df <- group(df)

grouped_OG_18020163 <- group(geo_OG_18020163)
grouped_REACH_18020163 <- group(geo_REACH_18020163)
grouped_UNI_18020163 <- group(geo_UNI_18020163)


#Call data to run through the aggregate R^2 plot function
#agg_r_plot(grouped_df, "plot title")

agg_r_plot(grouped_OG_18020163, "Original")
agg_r_plot(grouped_REACH_18020163, "By Reach Updates")
agg_r_plot(grouped_UNI_18020163, "Universal Updates")

```

### Electivity Index
```{r}
#call data to run through Electivity Index Function
#EI(df)

EI(geo_OG_18020163)
EI(geo_REACH_18020163)
EI(geo_UNI_18020163)

```

### RMSE 
```{r}
#Call data to run through RMSE function 
#RMSE(df, title)

RMSE(geo_OG_18020163, "subset OG_18020163")
RMSE(geo_REACH_18020163, "subset REACH_18020163")
RMSE(geo_UNI_18020163, "subset UNI_18020163")

```

### Mean Absolute Error
```{r}
#Call data to run MAE function 
#MAE(df, title)
MAE(geo_OG_18020163, "subset OG_18020163")
MAE(geo_REACH_18020163, "subset REACH_18020163")
MAE(geo_UNI_18020163, "subset UNI_18020163")


```


### Confusion Matrix
####Clean Up Data
```{r}
#Call function to Add Observed Categories to data
#observed_cat(df)

geo_OG_18020163 <- observed_cat(geo_OG_18020163)
geo_REACH_18020163 <- observed_cat(geo_REACH_18020163)
geo_UNI_18020163 <- observed_cat(geo_UNI_18020163)


subset_OG_18020163 <- observed_cat(subset_OG_18020163)
subset_REACH_18020163 <- observed_cat(subset_REACH_18020163)
subset_UNI_18020163 <- observed_cat(subset_UNI_18020163)


```

#### Confusion Matrix Table and Plot
```{r}
# Call data to run CM function
#CM(df, "title")

CM(geo_OG_18020163, "Original")
CM(geo_REACH_18020163, "By Reach Updates")
CM(geo_UNI_18020163, "Universal Updates")


CM(subset_OG_18020163, "Original (Observations Only)")
CM(subset_REACH_18020163, "By Reach Updates (Observations Only)")
CM(subset_UNI_18020163, "Universal Updates (Observations Only)")


```



#HUC 18020123######################################################################################
##Import Data 
```{r}
#Import Observed VS Predicted CSVs

#Original BRAT Version
OG_18020123 <- read_csv("18020123_NoVegUpdate_Observed_Capacity.csv")

#By REACH_18020123 Updated BRAT Version
REACH_18020123 <- read_csv("18020123_ByReachUpdate_Observed_Capacity.csv")

#Universal updated BRAT version
UNI_18020123 <- read_csv("18020123_UniversalUpdate_Observed_Capacity.csv")

sum(OG_18020123$DamKM>0)


```


## STEP 1: JUSTIFY CHANGES AND MODEL UPDATES ####################################################
### Multilinear Regression for Observed Beaver Capacity 
```{r}
#Significant Variables in the BRAT Attribute Table

#Multilinear Regression for Observed Beaver Capacity on all segments 
MLR_Observed <- lm(DamKM ~ iGeo_Len + iHyd_SPLow + iHyd_SP2 + iGeo_Slope + iVeg100EX + iVeg_30EX + iGeo_DA ,
  data = OG_18020123)

summary(MLR_Observed)

#Subset for only segments with observed capacity
Non_Zero_OG_18020123 <- subset(OG_18020123, DamKM != 0)

#Multilinear Regression for Observed Beaver Capacity on segments with observed capacity
MLR_subsetted_Observed <- lm(DamKM ~ iGeo_Len + iHyd_SPLow + iHyd_SP2 + iGeo_Slope + iVeg100EX + iVeg_30EX + iGeo_DA ,
  data = Non_Zero_OG_18020123)

summary(MLR_subsetted_Observed)

```


## STEP 2: RUN STATISTICS FOR COMPARISON ########################################################
###Clean Up Data
```{r}
#Subset data for segments with observed capacity and stream segments => 40
subset_OG_18020123 <- subset(OG_18020123, DamKM != 0 & iGeo_Len >= 40)
subset_REACH_18020123 <- subset(REACH_18020123, DamKM != 0 & iGeo_Len >= 40)
subset_UNI_18020123 <- subset(UNI_18020123, DamKM != 0 & iGeo_Len >= 40)

#Subset data for stream segments => 40
geo_OG_18020123 <- subset(OG_18020123, iGeo_Len >= 40)
geo_REACH_18020123 <- subset(REACH_18020123, iGeo_Len >= 40)
geo_UNI_18020123 <- subset(UNI_18020123, iGeo_Len >= 40)
```

### Multilinear Regression Adjusted R^2 Value ##
```{r}
#Call the function with your data 
#MLR_oCC_EX(df, title)

MLR_oCC_EX(geo_OG_18020123, "Original BRAT")
MLR_oCC_EX(geo_REACH_18020123, "By Reach Updated BRAT")
MLR_oCC_EX(geo_UNI_18020123, "Universal Updated BRAT")
```

### Aggregeated R^2 Value ##
```{r}
#Call data to run through the categorize function
#df <- categorize(df)

geo_OG_18020123 <- categorize(geo_OG_18020123)
geo_REACH_18020123 <- categorize(geo_REACH_18020123)
geo_UNI_18020123 <- categorize(geo_UNI_18020123)

subset_OG_18020123 <- categorize(subset_OG_18020123)
subset_REACH_18020123 <- categorize(subset_REACH_18020123)
subset_UNI_18020123 <- categorize(subset_UNI_18020123)


#Call data to run through the group function
#grouped_df <- group(df)

grouped_OG_18020123 <- group(geo_OG_18020123)
grouped_REACH_18020123 <- group(geo_REACH_18020123)
grouped_UNI_18020123 <- group(geo_UNI_18020123)


#Call data to run through the aggregate R^2 plot function
#agg_r_plot(grouped_df, "plot title")

agg_r_plot(grouped_OG_18020123, "Original")
agg_r_plot(grouped_REACH_18020123, "By Reach Updates")
agg_r_plot(grouped_UNI_18020123, "Universal Updates")

```

### Electivity Index
```{r}
#call data to run through Electivity Index Function
#EI(df)

EI(geo_OG_18020123)
EI(geo_REACH_18020123)
EI(geo_UNI_18020123)

```

### RMSE 
```{r}
#Call data to run through RMSE function 
#RMSE(df, title)

RMSE(geo_OG_18020123, "subset OG_18020123")
RMSE(geo_REACH_18020123, "subset REACH_18020123")
RMSE(geo_UNI_18020123, "subset UNI_18020123")

```

### Mean Absolute Error
```{r}
#Call data to run MAE function 
#MAE(df, title)
MAE(geo_OG_18020123, "subset OG_18020123")
MAE(geo_REACH_18020123, "subset REACH_18020123")
MAE(geo_UNI_18020123, "subset UNI_18020123")


```


### Confusion Matrix
####Clean Up Data
```{r}
#Call function to Add Observed Categories to data
#observed_cat(df)

geo_OG_18020123 <- observed_cat(geo_OG_18020123)
geo_REACH_18020123 <- observed_cat(geo_REACH_18020123)
geo_UNI_18020123 <- observed_cat(geo_UNI_18020123)


subset_OG_18020123 <- observed_cat(subset_OG_18020123)
subset_REACH_18020123 <- observed_cat(subset_REACH_18020123)
subset_UNI_18020123 <- observed_cat(subset_UNI_18020123)


```

#### Confusion Matrix Table and Plot
```{r}
# Call data to run CM function
#CM(df, "title")

CM(geo_OG_18020123, "Original")
CM(geo_REACH_18020123, "By Reach Updates")
CM(geo_UNI_18020123, "Universal Updates")


CM(subset_OG_18020123, "Original (Observations Only)")
CM(subset_REACH_18020123, "By Reach Updates (Observations Only)")
CM(subset_UNI_18020123, "Universal Updates (Observations Only)")


```




#HUC 18020002######################################################################################
##Import Data 
```{r}
#Import Observed VS Predicted CSVs

#Original BRAT Version
OG_18020002 <- read_csv("18020002_NoVegUpdate_Observed_Capacity.csv")

#By REACH_18020002 Updated BRAT Version
REACH_18020002 <- read_csv("18020002_ByReachUpdate_Observed_Capacity.csv")

#Universal updated BRAT version
UNI_18020002 <- read_csv("18020002_UniversalUpdate_Observed_Capacity.csv")

sum(OG_18020002$DamKM>0)

```


## STEP 1: JUSTIFY CHANGES AND MODEL UPDATES ####################################################
### Multilinear Regression for Observed Beaver Capacity 
```{r}
#Significant Variables in the BRAT Attribute Table

#Multilinear Regression for Observed Beaver Capacity on all segments 
MLR_Observed <- lm(DamKM ~ iGeo_Len + iHyd_SPLow + iHyd_SP2 + iGeo_Slope + iVeg100EX + iVeg_30EX + iGeo_DA ,
  data = OG_18020002)

summary(MLR_Observed)

#Subset for only segments with observed capacity
Non_Zero_OG_18020002 <- subset(OG_18020002, DamKM != 0)

#Multilinear Regression for Observed Beaver Capacity on segments with observed capacity
MLR_subsetted_Observed <- lm(DamKM ~ iGeo_Len + iHyd_SPLow + iHyd_SP2 + iGeo_Slope + iVeg100EX + iVeg_30EX + iGeo_DA ,
  data = Non_Zero_OG_18020002)

summary(MLR_subsetted_Observed)

```


## STEP 2: RUN STATISTICS FOR COMPARISON ########################################################
###Clean Up Data
```{r}
#Subset data for segments with observed capacity and stream segments => 40
subset_OG_18020002 <- subset(OG_18020002, DamKM != 0 & iGeo_Len >= 40)
subset_REACH_18020002 <- subset(REACH_18020002, DamKM != 0 & iGeo_Len >= 40)
subset_UNI_18020002 <- subset(UNI_18020002, DamKM != 0 & iGeo_Len >= 40)

#Subset data for stream segments => 40
geo_OG_18020002 <- subset(OG_18020002, iGeo_Len >= 40)
geo_REACH_18020002 <- subset(REACH_18020002, iGeo_Len >= 40)
geo_UNI_18020002 <- subset(UNI_18020002, iGeo_Len >= 40)
```

### Multilinear Regression Adjusted R^2 Value ##
```{r}
#Call the function with your data 
#MLR_oCC_EX(df, title)

MLR_oCC_EX(geo_OG_18020002, "Original BRAT")
MLR_oCC_EX(geo_REACH_18020002, "By Reach Updated BRAT")
MLR_oCC_EX(geo_UNI_18020002, "Universal Updated BRAT")
```

### Aggregeated R^2 Value ##
```{r}
#Call data to run through the categorize function
#df <- categorize(df)

geo_OG_18020002 <- categorize(geo_OG_18020002)
geo_REACH_18020002 <- categorize(geo_REACH_18020002)
geo_UNI_18020002 <- categorize(geo_UNI_18020002)

subset_OG_18020002 <- categorize(subset_OG_18020002)
subset_REACH_18020002 <- categorize(subset_REACH_18020002)
subset_UNI_18020002 <- categorize(subset_UNI_18020002)


#Call data to run through the group function
#grouped_df <- group(df)

grouped_OG_18020002 <- group(geo_OG_18020002)
grouped_REACH_18020002 <- group(geo_REACH_18020002)
grouped_UNI_18020002 <- group(geo_UNI_18020002)


#Call data to run through the aggregate R^2 plot function
#agg_r_plot(grouped_df, "plot title")

agg_r_plot(grouped_OG_18020002, "Original")
agg_r_plot(grouped_REACH_18020002, "By Reach Updates")
agg_r_plot(grouped_UNI_18020002, "Universal Updates")

```

### Electivity Index
```{r}
#call data to run through Electivity Index Function
#EI(df)

EI(geo_OG_18020002)
EI(geo_REACH_18020002)
EI(geo_UNI_18020002)

```

### RMSE 
```{r}
#Call data to run through RMSE function 
#RMSE(df, title)

RMSE(geo_OG_18020002, "subset OG_18020002")
RMSE(geo_REACH_18020002, "subset REACH_18020002")
RMSE(geo_UNI_18020002, "subset UNI_18020002")

```

### Mean Absolute Error
```{r}
#Call data to run MAE function 
#MAE(df, title)
MAE(geo_OG_18020002, "subset OG_18020002")
MAE(geo_REACH_18020002, "subset REACH_18020002")
MAE(geo_UNI_18020002, "subset UNI_18020002")


```


### Confusion Matrix
####Clean Up Data
```{r}
#Call function to Add Observed Categories to data
#observed_cat(df)

geo_OG_18020002 <- observed_cat(geo_OG_18020002)
geo_REACH_18020002 <- observed_cat(geo_REACH_18020002)
geo_UNI_18020002 <- observed_cat(geo_UNI_18020002)


subset_OG_18020002 <- observed_cat(subset_OG_18020002)
subset_REACH_18020002 <- observed_cat(subset_REACH_18020002)
subset_UNI_18020002 <- observed_cat(subset_UNI_18020002)


```

#### Confusion Matrix Table and Plot
```{r}
# Call data to run CM function
#CM(df, "title")

CM(geo_OG_18020002, "Original")
CM(geo_REACH_18020002, "By Reach Updates")
CM(geo_UNI_18020002, "Universal Updates")


CM(subset_OG_18020002, "Original (Observations Only)")
CM(subset_REACH_18020002, "By Reach Updates (Observations Only)")
CM(subset_UNI_18020002, "Universal Updates (Observations Only)")


```








